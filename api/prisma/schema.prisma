generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ====================================================
// 0. –°–ü–†–ê–í–û–ß–ù–ò–ö–ò (TOKENS, ENUMS)
// ====================================================

model CryptoToken {
  id Int @id @default(autoincrement())

  symbol    String
  name      String
  network   String   @default("ERC-20")
  decimals  Int
  createdAt DateTime @default(now())

  // –°–≤—è–∑–∏
  crashBets           CrashBet[]            @relation("CrashTokenBets")
  crashTransactions   CrashTransaction[]    @relation("CrashTransactionTokens")
  minesweeperGames    MinesweeperGame[]     @relation("MinesweeperTokens")
        minesweeperBets     MinesweeperBet[]      @relation("MinesweeperBetTokens")
        plinkoGames         PlinkoGame[]          @relation("PlinkoGames")
        plinkoBets          PlinkoBet[]           @relation("PlinkoBetTokens")
        coinFlipGames       CoinFlipGame[]        @relation("CoinFlipGames")
        coinFlipBets        CoinFlipBet[]         @relation("CoinFlipBetTokens")
        balances            Balance[]
        wallets             UserWallet[]
        transactions        Transaction[]
        bets                Bet[]
        leaderboard         LeaderboardEntry[]
        userBonuses         UserBonus[]
        referralCommissions ReferralTransaction[]
        referralStats       ReferralStats[]

  // –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ symbol + network (–º–æ–∂–Ω–æ –∏–º–µ—Ç—å USDT TRC-20, USDT ERC-20 –∏ —Ç.–¥.)
  @@unique([symbol, network])
  @@index([symbol])
}

enum GameType {
  SLOT
  ROULETTE
  BLACKJACK
  CRASH
  LIVE_DEALER
  MINESWEEPER
  COINFLIP
}

enum TransactionType {
  DEPOSIT
  WITHDRAW
  BONUS
  REFUND
  TRANSFER
  REFERRAL_COMMISSION
  BONUS_TO_MAIN
}

enum TransactionStatus {
  PENDING
  COMPLETED
  FAILED
}

enum BalanceType {
  MAIN
  BONUS
}

enum ReferralEventType {
  BET_COMMISSION
  DEPOSIT_BONUS
}

enum ReferrerType {
  REGULAR
  WORKER
}

// ====================================================
// 1. –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–Ø –ò –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò (USERS)
// ====================================================

model User {
  id           Int     @id @default(autoincrement())
  telegramId   String  @unique
  username     String? @unique
  firstName    String?
  lastName     String?
  photoUrl     String?
  passwordHash String?
  salt         String?
  isAdmin      Boolean @default(false)
  isBlocked    Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
  referralCode String @unique @default(cuid())
  referredById Int?
  referrer     User?  @relation("UserReferrals", fields: [referredById], references: [id])
  referrals    User[] @relation("UserReferrals")

  referrerType ReferrerType @default(REGULAR)

  // –°–≤—è–∑–∏
  crashBets          CrashBet[]            @relation("CrashBets")
  crashTransactions  CrashTransaction[]    @relation("CrashTransactions")
  minesweeperGames   MinesweeperGame[]     @relation("MinesweeperGames")
  minesweeperBets    MinesweeperBet[]      @relation("MinesweeperBets")
  plinkoGames        PlinkoGame[]          @relation("PlinkoGames")
  plinkoBets         PlinkoBet[]           @relation("PlinkoBets")
  coinFlipGames      CoinFlipGame[]        @relation("CoinFlipGames")
  coinFlipBets       CoinFlipBet[]         @relation("CoinFlipBets")
  balances           Balance[]
  wallets            UserWallet[]
  transactions       Transaction[] @relation("UserTransactions")
  approvedTransactions Transaction[] @relation("ApprovedTransactions")
  bets               Bet[]
  leaderboardEntries LeaderboardEntry[]
  bonuses            UserBonus[]
  commissions        ReferralTransaction[]
  referralActions    ReferralTransaction[] @relation("RefereeActions")
  authTokens         OneTimeToken[]

  referralStatsAsReferrer ReferralStats[] @relation("ReferrerStats")
  referralStatsAsReferee  ReferralStats[] @relation("RefereeStats")
}

// ====================================================
// 2. –§–ò–ù–ê–ù–°–´ –ò –ë–ê–õ–ê–ù–° (BALANCE)
// ====================================================

model Balance {
  id Int @id @default(autoincrement())

  userId Int
  user   User @relation(fields: [userId], references: [id], onDelete: Cascade)

  tokenId Int
  token   CryptoToken @relation(fields: [tokenId], references: [id])

  type   BalanceType @default(MAIN)
  amount Decimal     @default(0.0) @db.Decimal(30, 18)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, tokenId, type])
  @@index([userId])
}

// ====================================================
// 2.1. –ö–û–®–ï–õ–¨–ö–ò –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô (USER WALLETS)
// ====================================================
// –ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ—à–µ–ª–µ–∫ –¥–ª—è –∫–∞–∂–¥–æ–π –≤–∞–ª—é—Ç—ã
// –ö–∞–∫ –≤ Stake - –≤–∞–ª—é—Ç–∞ –Ω–µ –ø–µ—Ä–µ—Å–µ–∫–∞—é—Ç—Å—è, —É –∫–∞–∂–¥–æ–π —Å–≤–æ–π –∫–æ—à–µ–ª–µ–∫

model UserWallet {
  id Int @id @default(autoincrement())

  userId Int
  user   User @relation(fields: [userId], references: [id], onDelete: Cascade)

  tokenId Int
  token   CryptoToken @relation(fields: [tokenId], references: [id])

  // –ê–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞ –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π –¥–ª—è –∫–∞–∂–¥–æ–π –≤–∞–ª—é—Ç—ã)
  address      String   @unique
  privateKey   String?  // –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω)
  network      String   // –°–µ—Ç—å (TRC-20, ERC-20, BTC –∏ —Ç.–¥.)
  
  // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
  isActive     Boolean  @default(true)
  lastUsedAt   DateTime?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // –û–¥–∏–Ω –∫–æ—à–µ–ª–µ–∫ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∫–∞–∂–¥–æ–π –≤–∞–ª—é—Ç—ã
  @@unique([userId, tokenId])
  @@index([userId])
  @@index([address])
}

// ====================================================
// 3. –¢–†–ê–ù–ó–ê–ö–¶–ò–ò (–í–≤–æ–¥/–í—ã–≤–æ–¥)
// ====================================================

model Transaction {
  id Int @id @default(autoincrement())

  userId Int
  user   User @relation("UserTransactions", fields: [userId], references: [id], onDelete: Cascade)

  tokenId Int
  token   CryptoToken @relation(fields: [tokenId], references: [id])

  type   TransactionType
  status TransactionStatus @default(PENDING)

  amount Decimal @db.Decimal(30, 18)

  txHash        String?
  walletAddress String?
  
  // –ö—Ç–æ –æ–¥–æ–±—Ä–∏–ª/–æ—Ç–∫–ª–æ–Ω–∏–ª –∑–∞—è–≤–∫—É (–¥–ª—è –≤—ã–≤–æ–¥–æ–≤)
  approvedById Int?
  approvedBy   User? @relation("ApprovedTransactions", fields: [approvedById], references: [id])
  approvedAt   DateTime?
  
  // –ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  rejectReason String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([txHash, userId], map: "Transaction_txHash_userId_key")
  @@index([userId, createdAt])
}

// ====================================================
// 4. –°–¢–ê–í–ö–ò –ò –ò–ì–†–´ (BETS)
// ====================================================

model Bet {
  id Int @id @default(autoincrement())

  userId Int
  user   User @relation(fields: [userId], references: [id], onDelete: Cascade)

  tokenId Int
  token   CryptoToken @relation(fields: [tokenId], references: [id])

  gameType GameType

  betAmount    Decimal @db.Decimal(30, 18)
  payoutAmount Decimal @db.Decimal(30, 18)
  netAmount    Decimal @db.Decimal(30, 18)

  payoutRatio Float
  roundId     String
  details     Json?

  createdAt DateTime @default(now())

  @@index([userId, gameType, createdAt])
}

// ====================================================
// 5. –ë–û–ù–£–°–´ –ò –û–¢–´–ì–†–´–® (GAMING LOGIC)
// ====================================================

model Bonus {
  id                 Int     @id @default(autoincrement())
  name               String  @unique
  description        String
  wageringMultiplier Float
  maxBonusAmount     Decimal @db.Decimal(30, 18)

  depositBonusPercent Float @default(0)

  userBonuses UserBonus[]
}

model UserBonus {
  id Int @id @default(autoincrement())

  userId Int
  user   User @relation(fields: [userId], references: [id], onDelete: Cascade)

  bonusId Int?
  bonus   Bonus? @relation(fields: [bonusId], references: [id])

  tokenId Int
  token   CryptoToken @relation(fields: [tokenId], references: [id])

  grantedAmount Decimal @db.Decimal(30, 18)
  requiredWager Decimal @db.Decimal(30, 18)
  wageredAmount Decimal @default(0.0) @db.Decimal(30, 18)

  isActive    Boolean   @default(true)
  isCompleted Boolean   @default(false)
  completedAt DateTime?

  referrerId Int?

  createdAt DateTime  @default(now())
  expiresAt DateTime?

  // ‚úÖ –ë–ï–ó –ö–û–ù–§–õ–ò–ö–¢–£–Æ–©–ï–ì–û UNIQUE CONSTRAINT!
  // –¢–æ–ª—å–∫–æ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –ë–ï–ó —Å—Ç—Ä–æ–≥–∏—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
  @@index([userId, isActive])
  @@index([expiresAt])
  @@index([createdAt])
}

// ====================================================
// 6. –¢–ê–ë–õ–ò–¶–ê –õ–ò–î–ï–†–û–í (LEADERBOARD)
// ====================================================

model LeaderboardEntry {
  id Int @id @default(autoincrement())

  userId Int
  user   User @relation(fields: [userId], references: [id], onDelete: Cascade)

  tokenId Int?
  token   CryptoToken? @relation(fields: [tokenId], references: [id])

  metric String
  score  Decimal @db.Decimal(30, 18)
  period String

  updatedAt DateTime @updatedAt

  @@unique([userId, metric, period, tokenId])
  @@index([metric, period, score(sort: Desc)])
}

// ====================================================
// 7. –†–ï–§–ï–†–ê–õ–¨–ù–ê–Ø –°–ò–°–¢–ï–ú–ê (REFERRAL TRANSACTIONS)
// ====================================================

model ReferralTransaction {
  id Int @id @default(autoincrement())

  referrerId Int
  referrer   User @relation(fields: [referrerId], references: [id], onDelete: Cascade)

  refereeId Int
  referee   User @relation("RefereeActions", fields: [refereeId], references: [id], onDelete: Cascade)

  tokenId Int
  token   CryptoToken @relation(fields: [tokenId], references: [id])

  eventType ReferralEventType

  amount Decimal @db.Decimal(30, 18)

  sourceEntityId   Int
  sourceEntityType String

  createdAt DateTime @default(now())

  @@index([referrerId, createdAt])
  @@index([refereeId, createdAt])
}

// ====================================================
// üÜï 8. –°–¢–ê–¢–ò–°–¢–ò–ö–ê –†–ï–§–ï–†–ê–õ–û–í (–ê–ö–ö–£–ú–£–õ–ò–†–û–í–ê–ù–ù–´–ô –û–ë–û–†–û–¢)
// ====================================================

model ReferralStats {
  id Int @id @default(autoincrement())

  // –†–µ—Ñ–µ—Ä–µ—Ä (–∫—Ç–æ –ø–æ–ª—É—á–∞–µ—Ç –∫–æ–º–∏—Å—Å–∏—é)
  referrerId Int
  referrer   User @relation("ReferrerStats", fields: [referrerId], references: [id], onDelete: Cascade)

  // –†–µ—Ñ–µ—Ä–∞–ª (–∫—Ç–æ –∏–≥—Ä–∞–µ—Ç)
  refereeId Int
  referee   User @relation("RefereeStats", fields: [refereeId], references: [id], onDelete: Cascade)

  // –¢–æ–∫–µ–Ω
  tokenId Int
  token   CryptoToken @relation(fields: [tokenId], references: [id])

  // ‚≠ê –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–û–õ–Ø:

  // –û–±—â–∏–π –æ–±–æ—Ä–æ—Ç —Ä–µ—Ñ–µ—Ä–∞–ª–∞ (–≤—Å—è –∏—Å—Ç–æ—Ä–∏—è)
  totalTurnover Decimal @default(0) @db.Decimal(30, 18)

  // ‚≠ê –°–¢–ê–†–û–ï –ü–û–õ–ï (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏)
  // –û–±–æ—Ä–æ—Ç —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤—ã–ø–ª–∞—Ç—ã –∫–æ–º–∏—Å—Å–∏–∏ (–æ–±–Ω—É–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –≤—ã–ø–ª–∞—Ç—ã)
  turnoverSinceLastPayout Decimal @default(0) @db.Decimal(30, 18)

  // ‚≠ê –î–õ–Ø WORKER: –ü–æ—Ç–µ—Ä–∏ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤—ã–ø–ª–∞—Ç—ã (–æ–±–Ω—É–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –≤—ã–ø–ª–∞—Ç—ã)
  // –≠—Ç–æ –ø–æ–ª–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–º–∏—Å—Å–∏–∏ WORKER –∏ –æ–±–Ω—É–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –≤—ã–ø–ª–∞—Ç—ã
  newLossesSinceLastPayout Decimal @default(0) @db.Decimal(30, 18)

  // –ö–∞–∑–∏–Ω–æ –≤—ã–∏–≥—Ä–∞–ª–æ (–ø–æ—Ç–µ—Ä–∏ –∏–≥—Ä–æ–∫–æ–≤) - –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ —Ä–∞—Å—á–µ—Ç–∞ –ø—Ä–æ—Ñ–∏—Ç–∞ –≤–æ—Ä–∫–µ—Ä–æ–≤
  totalLosses Decimal @default(0) @db.Decimal(30, 18)

  // –ò–≥—Ä–æ–∫–∏ –≤—ã–∏–≥—Ä–∞–ª–∏ (—É–±—ã—Ç–∫–∏ –∫–∞–∑–∏–Ω–æ)
  totalWinnings Decimal @default(0) @db.Decimal(30, 18)

  // –û–±—â–∞—è —Å—É–º–º–∞ –≤—ã–ø–ª–∞—á–µ–Ω–Ω—ã—Ö –∫–æ–º–∏—Å—Å–∏–π
  totalCommissionPaid Decimal @default(0) @db.Decimal(30, 18)

  // –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤—ã–ø–ª–∞—Ç—ã
  lastPayoutAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // –£–Ω–∏–∫–∞–ª—å–Ω–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è: –æ–¥–∏–Ω —Ä–µ—Ñ–µ—Ä–µ—Ä + –æ–¥–∏–Ω —Ä–µ—Ñ–µ—Ä–∞–ª + –æ–¥–∏–Ω —Ç–æ–∫–µ–Ω
  @@unique([referrerId, refereeId, tokenId])
  // –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
  @@index([referrerId])
  @@index([refereeId])
  @@index([turnoverSinceLastPayout]) // ‚≠ê –ò–Ω–¥–µ–∫—Å –¥–ª—è REGULAR (—Å—Ç–∞—Ä–æ–µ –ø–æ–ª–µ)
  @@index([newLossesSinceLastPayout]) // ‚≠ê –ò–Ω–¥–µ–∫—Å –¥–ª—è WORKER (–Ω–æ–≤–æ–µ –ø–æ–ª–µ)
  @@index([lastPayoutAt])
}

// ====================================================
// 9. –û–î–ù–û–†–ê–ó–û–í–´–ï –¢–û–ö–ï–ù–´ (ONE-TIME AUTHS)
// ====================================================

model OneTimeToken {
  id Int @id @default(autoincrement())

  token String @unique

  userId Int
  user   User @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  expiresAt DateTime

  used Boolean @default(false)

  @@index([token, expiresAt])
}

// ====================================================
// 10. CRASH GAME SPECIFIC MODELS
// ====================================================

model CrashRound {
  id Int @id @default(autoincrement())

  gameId     String  @unique
  crashPoint Decimal @db.Decimal(10, 2)

  totalPlayers Int @default(0)
  winnersCount Int @default(0)

  totalWagered Decimal @default(0) @db.Decimal(30, 18)
  totalPayouts Decimal @default(0) @db.Decimal(30, 18)

  serverSeedHash String @unique
  clientSeed     String
  nonce          Int    @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  bets CrashBet[]

  @@index([gameId])
  @@index([createdAt])
}

model CrashBet {
  id Int @id @default(autoincrement())

  roundId Int
  round   CrashRound @relation(fields: [roundId], references: [id], onDelete: Cascade)

  userId Int
  user   User @relation("CrashBets", fields: [userId], references: [id], onDelete: Cascade)

  tokenId Int
  token   CryptoToken @relation("CrashTokenBets", fields: [tokenId], references: [id])

  betAmount      Decimal  @db.Decimal(30, 18)
  exitMultiplier Decimal? @db.Decimal(10, 2)
  winnings       Decimal? @default(0) @db.Decimal(30, 18)
  result         String

  createdAt DateTime @default(now())

  transactions CrashTransaction[]

  @@index([userId, createdAt])
  @@index([roundId])
  @@index([result])
}

model CrashTransaction {
  id Int @id @default(autoincrement())

  userId Int
  user   User @relation("CrashTransactions", fields: [userId], references: [id], onDelete: Cascade)

  betId Int?
  bet   CrashBet? @relation(fields: [betId], references: [id], onDelete: Cascade)

  tokenId Int
  token   CryptoToken @relation("CrashTransactionTokens", fields: [tokenId], references: [id])

  amount Decimal @db.Decimal(30, 18)

  type String

  createdAt DateTime @default(now())

  @@index([userId, createdAt])
}

// ====================================================
// 11. MINESWEEPER GAME MODELS
// ====================================================

model MinesweeperDifficulty {
  id Int @id @default(autoincrement())

  name       String @unique
  minesCount Int
  gridSize   Int    @default(6)
  multiplier Float

  games MinesweeperGame[]

  createdAt DateTime @default(now())
}

model MinesweeperGame {
  id Int @id @default(autoincrement())

  userId Int
  user   User @relation("MinesweeperGames", fields: [userId], references: [id], onDelete: Cascade)

  tokenId Int
  token   CryptoToken @relation("MinesweeperTokens", fields: [tokenId], references: [id])

  difficultyId Int
  difficulty   MinesweeperDifficulty @relation(fields: [difficultyId], references: [id])

  gameState      Json
  minesPositions Json

  status        String @default("PLAYING")
  revealedCells Int    @default(0)
  flaggedCells  Int    @default(0)

  betAmount  Decimal  @db.Decimal(30, 18)
  winAmount  Decimal? @db.Decimal(30, 18)
  multiplier Float    @default(1.0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId, createdAt])
  @@index([status])
}

model PendingDeposit {
  id        Int      @id @default(autoincrement())
  userId    Int
  invoiceId String   @unique
  amount    Float
  asset     String   @default("USDT")
  network   String?  // –°–µ—Ç—å –≤–∞–ª—é—Ç—ã (TRC-20, ERC-20, BTC –∏ —Ç.–¥.)
  status    String   @default("pending")
  withBonus Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([status, createdAt])
}

model MinesweeperBet {
  id Int @id @default(autoincrement())

  userId Int
  user   User @relation("MinesweeperBets", fields: [userId], references: [id], onDelete: Cascade)

  tokenId Int
  token   CryptoToken @relation("MinesweeperBetTokens", fields: [tokenId], references: [id])

  gameId Int

  betAmount Decimal  @db.Decimal(30, 18)
  winAmount Decimal? @db.Decimal(30, 18)

  result     String
  multiplier Float

  createdAt DateTime @default(now())

  @@index([userId, createdAt])
}

// ====================================================
// 12. PLINKO GAME MODELS
// ====================================================

model PlinkoGame {
  id Int @id @default(autoincrement())

  userId Int
  user   User @relation("PlinkoGames", fields: [userId], references: [id], onDelete: Cascade)

  tokenId Int
  token   CryptoToken @relation("PlinkoGames", fields: [tokenId], references: [id])

  betAmount Decimal @db.Decimal(30, 18)
  winAmount Decimal @db.Decimal(30, 18)

  ballPath      String // JSON –º–∞—Å—Å–∏–≤ –ø—É—Ç–∏ —à–∞—Ä–∏–∫–∞
  finalPosition Int // –§–∏–Ω–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è (0-14)
  multiplier    Float // –ú–Ω–æ–∂–∏—Ç–µ–ª—å –≤—ã–∏–≥—Ä—ã—à–∞
  status        String @default("COMPLETED") // COMPLETED, CANCELLED

  createdAt DateTime @default(now())

  @@index([userId, createdAt])
  @@index([status])
}

model PlinkoBet {
  id Int @id @default(autoincrement())

  userId Int
  user   User @relation("PlinkoBets", fields: [userId], references: [id], onDelete: Cascade)

  tokenId Int
  token   CryptoToken @relation("PlinkoBetTokens", fields: [tokenId], references: [id])

  gameId Int

  betAmount Decimal @db.Decimal(30, 18)
  winAmount Decimal @db.Decimal(30, 18)

  result     String // "won" –∏–ª–∏ "lost"
  multiplier Float

  createdAt DateTime @default(now())

  @@index([userId, createdAt])
}

// ====================================================
// 13. COINFLIP GAME MODELS
// ====================================================

model CoinFlipGame {
  id Int @id @default(autoincrement())

  userId Int
  user   User @relation("CoinFlipGames", fields: [userId], references: [id], onDelete: Cascade)

  tokenId Int
  token   CryptoToken @relation("CoinFlipGames", fields: [tokenId], references: [id])

  betAmount  Decimal  @db.Decimal(30, 18)
  winAmount  Decimal? @db.Decimal(30, 18)

  choice     String   // "heads" –∏–ª–∏ "tails" (–æ—Ä—ë–ª –∏–ª–∏ —Ä–µ—à–∫–∞)
  result     String   // "heads" –∏–ª–∏ "tails" ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–¥–±—Ä–∞—Å—ã–≤–∞–Ω–∏—è
  multiplier Float    @default(1.8)
  status     String   @default("COMPLETED") // COMPLETED

  createdAt DateTime @default(now())

  @@index([userId, createdAt])
  @@index([status])
}

model CoinFlipBet {
  id Int @id @default(autoincrement())

  userId Int
  user   User @relation("CoinFlipBets", fields: [userId], references: [id], onDelete: Cascade)

  tokenId Int
  token   CryptoToken @relation("CoinFlipBetTokens", fields: [tokenId], references: [id])

  gameId Int

  betAmount Decimal  @db.Decimal(30, 18)
  winAmount Decimal? @db.Decimal(30, 18)

  choice     String  // "heads" –∏–ª–∏ "tails"
  result     String  // "heads" –∏–ª–∏ "tails"
  multiplier Float

  createdAt DateTime @default(now())

  @@index([userId, createdAt])
}
